Sieve Working Group K. Murchison Internet-Draft Carnegie Mellon University Obsoletes: 3598 (if approved) June 15, 2006 Expires: December 17, 2006 Sieve Email Filtering -- Subaddress Extension draft-ietf-sieve-rfc3598bis 1. Introduction Subaddressing is the practice of augmenting the local-part of an [RFC2822] address with some 'detail' information in order to give some extra meaning to that address. One common way of encoding 'detail' information into the local-part is to add a 'separator character sequence', such as "+", to form a boundary between the 'user' (original local-part) and 'detail' sub-parts of the address, much like the "@" character forms the boundary between the local-part and domain. Typical uses of subaddressing might be: o A message addressed to "ken+sieve@example.org" is delivered into a mailbox called "sieve" belonging to the user "ken". o A message addressed to "5551212#123@example.com" is delivered to the voice mailbox number "123" at phone number "5551212". This document describes an extension to the Sieve language defined by  4. Subaddress Comparisons Test commands that act exclusively on addresses may take the optional tagged arguments ":user" and ":detail" to specify what sub-part of the local-part of the address will be acted upon. NOTE: In most cases, the envelope "to" address is the preferred address to examine for subaddress information when the desire is to sort messages based on how they were addressed so as to get to a specific recipient. The envelope address is, after all, the reason a given message is being processed by a given sieve script for a given user. This is particularly true when mailing lists, aliases, and 'virtual domains' are involved since the envelope may be the only source of detail information for the specific recipient. NOTE: Because the encoding of detailed addresses are site and/or implementation specific, using the subaddress extension on foreign addresses (such as the envelope "from" address or originator header fields) may lead to inconsistent or incorrect results. The ":user" argument specifies the user sub-part of the local-part of an address. If the address is not encoded to contain a detail sub- part, then ":user" specifies the entire left-side of the address (equivalent to ":localpart"). The ":detail" argument specifies the detail sub-part of the local- part of an address. If the address is not encoded to contain a detail sub-part, then the test evaluates to false. If a zero-length string is encoded as the detail sub-part, then ":detail" resolves to the empty value (""). NOTE: If the encoding method used for detailed addresses utilizes a separator character sequence, and the separator character sequence occurs more than once in the local-part, then the logic used to split the address is implementation defined, and is usually dependent on the format used by the encompassing mail system. Implementations MUST make sure that the encoding method used for detailed addresses matches that which is used and/or allowed by the encompassing mail system, otherwise unexpected results might occur. Note that the mechanisms used to define and/or query the encoding method used by the mail system are outside the scope of this document. The ":user" and ":detail" address parts are subject to the same rules and restrictions as the standard address parts defined in  ["subaddress", "fileinto"]; # In this example the same user account receives mail for both # "ken@example.com" and "postmaster@example.com" # File all messages to postmaster into a single mailbox, # ignoring the :detail part. if envelope :user "to" "postmaster" { fileinto "inbox.postmaster"; stop; } # File mailing list messages (subscribed as "ken+mta-filters"). if envelope :detail "to" "mta-filters" { fileinto "inbox.ietf-mta-filters"; } # Redirect all mail sent to "ken+foo". if envelope :detail "to" "foo" { redirect "ken@example.net"; } Murchison Appendix A. Acknowledgments Thanks to Tim Showalter, Alexey Melnikov, Michael Salmon, Randall Gellens, Philip Guenther, Jutta Degener, Michael Haardt, Ned Freed, Mark Mallett, and Barry Leiba for their help with this document. Murchison Expires December 17, 2006 [Page 10]
Internet-Draft Sieve -- Subaddress Extension June 2006 Appendix B. Changes since RFC3598 o Discussion of how the user and detail information is encoded now uses generic language. o Added note detailing that this extension is most useful when used on the envelope "to" address. o Added note detailing that this extension isn't very useful on foreign addresses (envelope "from" or originator header fields). o Fixed envelope test example to only use "to" address. o Replaced ":user" example with one that doesn't produce unexpected behavior. o Refer to the zero-length string ("") as "empty" instead of "null" (per Extensionurchison Expires December 17, 2006 [Page 13]